flowchart LR

  %% =============================
  %% USER / CLI ENTRY
  %% =============================
  A["ğŸ‘¤ User / CI<br/>spectramind CLI"] --> B["âš™ï¸ Hydra Configs<br/>env, data, calib, model, loss, training"]

  %% =============================
  %% PIPELINE STAGES
  %% =============================
  B --> C["ğŸ”§ Calibrate<br/>raw â†’ calibrated"]
  C --> D["ğŸ§¹ Preprocess<br/>calibrated â†’ tensors"]
  D --> E["ğŸ§‘â€ğŸ« Train<br/>tensors â†’ checkpoints"]
  E --> F["ğŸ”® Predict<br/>checkpoints â†’ Î¼, Ïƒ"]
  F --> G["ğŸ©º Diagnose<br/>inject-&-recover, HTML dashboard"]
  F --> H["ğŸ“¦ Submit<br/>package, schema validate, zip/json"]

  %% =============================
  %% ARTIFACTS & STORAGE
  %% =============================
  C -.-> Z["ğŸ“‚ data/interim/calibrated/ (DVC)"]
  D -.-> Y["ğŸ“‚ data/processed/tensors/ (DVC)"]
  E -.-> X["ğŸ’¾ artifacts/checkpoints/model.ckpt"]
  F -.-> W["ğŸ“‘ artifacts/predictions/{mu.csv, sigma.csv}"]
  G -.-> V["ğŸ“Š artifacts/reports/diagnostics_dashboard.html"]
  H -.-> U["ğŸ—œï¸ dist/submission.{zip,json,csv}"]

  %% =============================
  %% REMOTE CACHE
  %% =============================
  Z -.-> R["â˜ï¸ DVC Remote<br/>local / S3 / SSH"]
  Y -.-> R
  X -.-> R
  W -.-> R

  %% =============================
  %% FLEXIBLE / SKIP PATHS
  %% =============================
  %% Start from pre-calibrated data
  B -. skip .-> D
  %% Reuse tensors without retraining
  D -. skip .-> F
  %% Reuse old checkpoints directly for inference
  X -. reuse .-> F
  %% Predict-only Kaggle kernel path
  B -. predict_only .-> F

  %% =============================
  %% STYLES
  %% =============================
  classDef stage fill:#bbf,stroke:#333,stroke-width:1px;
  classDef artifact fill:#eef,stroke:#666,stroke-width:1px,stroke-dasharray: 3 3;
  classDef remote fill:#ffd,stroke:#333,stroke-width:1px;

  class B,C,D,E,F,G,H stage;
  class Z,Y,X,W,V,U artifact;
  class R remote;
