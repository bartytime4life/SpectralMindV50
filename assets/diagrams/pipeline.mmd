%% SpectraMind V50 â€” End-to-End Pipeline (strict GitHub-safe)

flowchart TB

  %% Entry & Orchestration
  subgraph Entry_and_Orchestration
    direction TB
    UCI[User or CI]
    CLI[spectramind CLI: calibrate, preprocess, train, predict, diagnose, submit]
    HYDRA[Hydra configs]
    DVCCTL[DVC pipeline]
    UCI --> CLI --> HYDRA --> DVCCTL
  end

  %% Environment
  subgraph Runtime_Environment
    direction TB
    LOCAL[Local or CI]
    KAGGLE[Kaggle]
  end
  DVCCTL --> LOCAL
  DVCCTL --> KAGGLE

  %% External Inputs
  subgraph External_Inputs
    direction TB
    RAW[Ariel dataset path]
    CFG[Config files]
  end

  %% DVC Stages
  subgraph Reproducible_Pipeline
    direction TB
    Calib[calibrate]
    Prep[preprocess]
    Train[train]
    Predict[predict]
    Diagnose[diagnose]
    Submit[submit]
    Calib --> Prep --> Train --> Predict --> Diagnose --> Submit
  end

  %% Config into stages
  CFG --> Calib
  CFG --> Prep
  CFG --> Train
  CFG --> Predict
  CFG --> Diagnose
  CFG --> Submit

  %% Raw data into calibration
  RAW --> Calib

  %% Artifacts
  subgraph Versioned_Artifacts
    direction TB
    CALOUT[calibrated]
    FEAT[features]
    CKPT[model checkpoints]
    PRED[predictions]
    REP[diagnostics reports]
    SUBCSV[submission csv]
  end

  %% Stage outputs
  Calib --> CALOUT
  Prep --> FEAT
  Train --> CKPT
  Predict --> PRED
  Diagnose --> REP
  Submit --> SUBCSV

  %% Stage inputs from prior artifacts
  CALOUT --> Prep
  FEAT --> Train
  CKPT --> Predict
  FEAT --> Predict
  CKPT --> Diagnose
  FEAT --> Diagnose

  %% Kaggle specifics
  subgraph Kaggle_Notes
    direction TB
    KIN[inputs under kaggle input]
    KOUT[outputs under kaggle working]
  end
  RAW --> KIN
  SUBCSV --> KOUT

  %% Reproducibility
  subgraph Integrity_and_Reproducibility
    direction TB
    SNAP[config snapshot]
    JSONL[run manifest]
    DVCLOCK[dvc lock]
  end
  HYDRA --> SNAP
  DVCCTL --> DVCLOCK
  CLI --> JSONL
