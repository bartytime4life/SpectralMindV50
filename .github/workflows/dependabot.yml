# .github/dependabot.yml
# =============================================================================
# SpectraMind V50 — Dependabot Config (Upgraded)
# -----------------------------------------------------------------------------
# • Weekly checks for Python (pip & Poetry) and GitHub Actions
# • Smart groups to cut PR noise (ML core, testing, linting, docs, security/SBOM)
# • Safer defaults: rebase, scoped commit messages, PR limits, selective ignores
# • Timezone-aware scheduling aligned to repo cadence (America/Chicago)
# • Optional reviewers/assignees (commented) for triage routing
# =============================================================================

version: 2

updates:
  # ----------------------------
  # Python — pip (requirements*.txt)
  # ----------------------------
  - package-ecosystem: "pip"
    directory: "/"                   # Dependabot scans requirements*.txt here
    schedule:
      interval: "weekly"
      day: "monday"
      time: "04:00"
      timezone: "America/Chicago"
    open-pull-requests-limit: 10
    target-branch: "develop"
    rebase-strategy: "auto"
    labels: ["dependencies", "security", "pip"]
    # reviewers: [ "your-org/sec-reviewers" ]
    # assignees: [ "andybarta" ]
    commit-message:
      prefix: "deps(pip)"
      include: "scope"
    allow:
      - dependency-type: "direct"
    groups:
      core-ml:
        patterns:
          - "torch*"
          - "pytorch*"
          - "lightning*"
          - "hydra*"
          - "omegaconf*"
          - "numpy*"
          - "scipy*"
          - "pandas*"
          - "umap*"
      testing:
        patterns:
          - "pytest*"
          - "hypothesis*"
          - "coverage*"
      linting:
        patterns:
          - "ruff"
          - "flake8*"
          - "mypy*"
          - "black"
          - "isort"
      docs-notebooks:
        patterns:
          - "mkdocs*"
          - "nbconvert*"
          - "nbclient*"
          - "nbformat*"
          - "jupyter*"
      security-sbom:
        patterns:
          - "pip-audit*"
          - "bandit*"
          - "cyclonedx*"
          - "syft*"
          - "trivy*"
    ignore:
      # Avoid churn on heavyweight stacks you likely don’t use directly
      - dependency-name: "opencv-python*"
        update-types: ["version-update:semver-patch", "version-update:semver-minor"]
      - dependency-name: "tensorflow*"
      - dependency-name: "pygobject*"

  # ----------------------------
  # Python — Poetry (pyproject.toml / poetry.lock)
  # ----------------------------
  - package-ecosystem: "poetry"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "04:30"
      timezone: "America/Chicago"
    open-pull-requests-limit: 5
    target-branch: "develop"
    rebase-strategy: "auto"
    versioning-strategy: "increase"   # sensible semver increases
    labels: ["dependencies", "security", "poetry"]
    # reviewers: [ "your-org/sec-reviewers" ]
    commit-message:
      prefix: "deps(poetry)"
      include: "scope"
    allow:
      - dependency-type: "direct"
    groups:
      poetry-core:
        patterns:
          - "*"

  # ----------------------------
  # GitHub Actions (CI/CD)
  # ----------------------------
  - package-ecosystem: "github-actions"
    directory: "/"                   # scans .github/workflows/**
    schedule:
      interval: "weekly"
      day: "monday"
      time: "05:00"
      timezone: "America/Chicago"
    open-pull-requests-limit: 10
    rebase-strategy: "auto"
    labels: ["dependencies", "security", "ci"]
    # reviewers: [ "your-org/ci-admins" ]
    commit-message:
      prefix: "deps(actions)"
      include: "scope"
    groups:
      ci-core:
        patterns:
          - "actions/*"
          - "github/codeql-action*"
          - "docker/*"
      security-scanners:
        patterns:
          - "aquasecurity/trivy-action*"
          - "anchore/sbom-action*"
          - "anchore/syft-action*"
          - "gitleaks/gitleaks-action*"
      artifacts-cache:
        patterns:
          - "actions/upload-artifact*"
          - "actions/download-artifact*"
          - "actions/cache*"

# Notes:
# • Auto-merge is enforced via branch protection/merge rules (not here).
# • `target-branch: develop` funnels bumps through dev; set to `main` if you prefer.
# • Tweak ignore patterns for heavyweight stacks you don’t vendor directly.