# .github/dependabot.yml
# =============================================================================
# SpectraMind V50 — Dependabot Config (Upgraded)
# -----------------------------------------------------------------------------
# • Weekly checks for Python (pip & Poetry) and GitHub Actions
# • Smart groups to cut PR noise (core ML, testing, linting, docs, security)
# • Safer defaults: rebase, scoped commit messages, limits, and selective ignores
# • Timezone-aware scheduling aligned to repo cadence
# =============================================================================

version: 2

updates:
  # ----------------------------
  # Python — pip (requirements*.txt)
  # ----------------------------
  - package-ecosystem: "pip"
    directory: "/"                   # detect requirements*.txt in repo
    schedule:
      interval: "weekly"
      day: "monday"
      time: "04:00"
      timezone: "America/Chicago"
    open-pull-requests-limit: 10
    target-branch: "develop"
    rebase-strategy: "auto"
    labels: ["dependencies", "security", "pip"]
    commit-message:
      prefix: "deps(pip)"
      include: "scope"
    # Prefer bumping direct deps; transitive bumps will arrive via lock/constraints
    allow:
      - dependency-type: "direct"
    # Group by function to reduce PR noise
    groups:
      core-ml:
        patterns:
          - "torch*"
          - "pytorch*"
          - "lightning*"
          - "hydra*"
          - "omegaconf*"
          - "numpy*"
          - "scipy*"
          - "pandas*"
      testing:
        patterns:
          - "pytest*"
          - "hypothesis*"
          - "coverage*"
      linting:
        patterns:
          - "ruff"
          - "flake8*"
          - "mypy*"
          - "black"
          - "isort"
      docs-notebooks:
        patterns:
          - "mkdocs*"
          - "nbconvert*"
          - "nbclient*"
          - "nbformat*"
          - "jupyter*"
      security-sbom:
        patterns:
          - "pip-audit*"
          - "bandit*"
          - "cyclonedx*"
          - "syft*"
          - "trivy*"
    # Avoid churn on huge binary stacks or system packages not used directly
    ignore:
      - dependency-name: "opencv-python*"
        update-types: ["version-update:semver-patch", "version-update:semver-minor"]
      - dependency-name: "tensorflow*"
      - dependency-name: "pygobject*"

  # ----------------------------
  # Python — Poetry (pyproject.toml, poetry.lock)
  # ----------------------------
  - package-ecosystem: "poetry"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "04:30"
      timezone: "America/Chicago"
    open-pull-requests-limit: 5
    target-branch: "develop"
    rebase-strategy: "auto"
    versioning-strategy: "increase"   # bump within semver sensibly
    labels: ["dependencies", "security", "poetry"]
    commit-message:
      prefix: "deps(poetry)"
      include: "scope"
    allow:
      - dependency-type: "direct"
    groups:
      poetry-core:
        patterns:
          - "*"

  # ----------------------------
  # GitHub Actions (CI/CD)
  # ----------------------------
  - package-ecosystem: "github-actions"
    directory: "/"                   # scans .github/workflows/**
    schedule:
      interval: "weekly"
      day: "monday"
      time: "05:00"
      timezone: "America/Chicago"
    open-pull-requests-limit: 10
    rebase-strategy: "auto"
    labels: ["dependencies", "security", "ci"]
    commit-message:
      prefix: "deps(actions)"
      include: "scope"
    groups:
      ci-core:
        patterns:
          - "actions/*"
          - "github/codeql-action*"
          - "docker/*"
      security-scanners:
        patterns:
          - "aquasecurity/trivy-action*"
          - "anchore/sbom-action*"
          - "anchore/syft-action*"
          - "gitleaks/gitleaks-action*"
      artifacts-cache:
        patterns:
          - "actions/upload-artifact*"
          - "actions/download-artifact*"
          - "actions/cache*"

# Notes:
# • Dependabot auto-merge is configured via repo settings/branch-protection.
# • `target-branch: develop` funnels bumps through dev; change to `main` if preferred.
# • Adjust ignore patterns for heavyweight stacks you do not use directly.