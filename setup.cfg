# ==============================================================================
# setup.cfg — SpectraMind V50
# ------------------------------------------------------------------------------
# Centralized config for:
#   • pytest   → test runner (quiet logs, clean CI output, markers, coverage)
#   • flake8   → linting and style checks (Black-compatible)
#   • mypy     → static type checking (strict where practical)
#   • coverage → code coverage settings (HTML/XML for CI)
#   • isort    → import sorting compatible with Black
#
# Ensures consistent developer experience across local, Kaggle, and CI.
# ==============================================================================

[tool:pytest]
# Unified, quiet defaults; fast failures; strict markers/config
addopts =
    -q
    --disable-warnings
    --maxfail=1
    --strict-markers
    --strict-config
    # Coverage (works when pytest-cov is installed; no-op otherwise)
    --cov=src/spectramind
    --cov-report=term-missing:skip-covered
    --cov-report=xml
    --cov-report=html
    -m "not slow"
testpaths =
    tests
    src/spectramind
# Keep logs readable in CI; local runs can override with -o
log_cli = false
log_level = WARNING
# Reduce noisy third-party warnings (Torch/Lightning/etc.) on CI/Kaggle
filterwarnings =
    ignore::DeprecationWarning:pkg_resources
    ignore::DeprecationWarning:tensorboard
    ignore::UserWarning:pytorch_lightning
    ignore::UserWarning:torch
    ignore::FutureWarning:torch
    ignore::FutureWarning:numpy
markers =
    slow: marks tests as slow (skipped by default)
    integration: marks tests requiring end-to-end or external assets
    kaggle: marks tests tailored for the Kaggle runtime
    gpu: marks tests requiring CUDA devices
# If you use pytest-xdist, uncomment:
#   -n auto

[coverage:run]
branch = True
source =
    src/spectramind
omit =
    */__init__.py
    */_version.py
    */.venv/*
    */venv/*
    */.tox/*
    */.mypy_cache/*
    */.ruff_cache/*
    */notebooks/*
    */docs/*
    */tests/*
    setup.py
concurrency = thread, multiprocessing
# Enable if you split coverage across parallel jobs on Linux CI:
# parallel = True

[coverage:report]
show_missing = True
skip_empty = True
precision = 2
exclude_lines =
    pragma: no cover
    if __name__ == .__main__.:
    @overload
    @abstractmethod
    raise NotImplementedError

[coverage:html]
directory = htmlcov

[coverage:xml]
output = coverage.xml

# ------------------------------------------------------------------------------
# flake8 (Black-compatible; suggested plugins:
# flake8-bugbear, flake8-docstrings, flake8-comprehensions, flake8-import-order)
# ------------------------------------------------------------------------------
[flake8]
max-line-length = 100
extend-ignore =
    E203,  # Whitespace before ':' (Black-compatible)
    W503,  # Line break before binary operator
    D107,  # Missing docstring in __init__ (allow lightweight class init)
    D202,  # Blank lines after function docstring (Black sometimes adds one)
    D401,  # Imperative first-line (relax for CLI/docs)
exclude =
    .git,
    __pycache__,
    build,
    dist,
    .venv,
    .eggs,
    *.egg-info,
    .tox,
    notebooks,
    docs
# Keep imports organized (with flake8-import-order)
import-order-style = google
application-import-names = spectramind, tests
# Complexity guardrails
max-complexity = 10
# Docstring style (with flake8-docstrings)
docstring-convention = numpy
# Per-file relaxations (e.g., CLI modules often import side-effectfully)
per-file-ignores =
    src/spectramind/__init__.py:F401
    src/spectramind/cli/__init__.py:F401
    src/spectramind/pipeline/__init__.py:F401

# ------------------------------------------------------------------------------
# mypy (static typing)
# ------------------------------------------------------------------------------
[mypy]
python_version = 3.11
ignore_missing_imports = True
show_error_codes = True
warn_unused_configs = True
warn_redundant_casts = True
warn_unused_ignores = True
warn_return_any = False
warn_no_return = True
disallow_untyped_defs = True
check_untyped_defs = True
no_implicit_optional = True
# Tighten gradually as code matures:
# disallow_any_generics = True
# strict_optional = True

# Keep CLI thin & allow dynamic imports/3rd-party boundaries with lighter rules
[mypy-spectramind.cli.*]
disallow_untyped_defs = False

[mypy-spectramind.pipeline.*]
disallow_untyped_defs = False

# Silence heavy vendor trees (torch/lightning/numpy/pandas) where needed
[mypy-torch.*]
ignore_missing_imports = True
[mypy-pytorch_lightning.*]
ignore_missing_imports = True
[mypy-numpy.*]
ignore_missing_imports = True
[mypy-pandas.*]
ignore_missing_imports = True
[mypy-scipy.*]
ignore_missing_imports = True

# ------------------------------------------------------------------------------
# isort (keep import order compatible with Black)
# ------------------------------------------------------------------------------
[isort]
profile = black
line_length = 100
multi_line_output = 3
include_trailing_comma = true
force_grid_wrap = 0
combine_as_imports = true
known_first_party = spectramind,tests
default_section = THIRDPARTY
skip =
    .git,
    __pycache__,
    build,
    dist,
    .venv,
    .eggs,
    .tox,
    notebooks,
    docs
